"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8353],{5961:(k,d,n)=>{n.d(d,{GW:()=>u,dk:()=>v,oK:()=>o});var o=function(i){return i.Prompt="PROMPT",i.Camera="CAMERA",i.Photos="PHOTOS",i}(o||{}),u=function(i){return i.Rear="REAR",i.Front="FRONT",i}(u||{}),v=function(i){return i.Uri="uri",i.Base64="base64",i.DataUrl="dataUrl",i}(v||{})},8353:(k,d,n)=>{n.r(d),n.d(d,{Tab2PageModule:()=>J});var o=n(1929),u=n(6814),v=n(95),i=n(2114),m=n(5861),T=n(2726),f=n(5961);const p=(0,T.fo)("Camera",{web:()=>n.e(6468).then(n.bind(n,6468)).then(t=>new t.CameraWeb)});var a=n(9212);let h=(()=>{var t;class s{constructor(){}takePicture(){return(0,m.Z)(function*(){let e=yield p.getPhoto({resultType:f.dk.DataUrl,source:f.oK.Camera});if("jpeg"!=e.format)throw new Error(`Image in wrong format. Images of format .${e.format} are not allowed`);return e.base64String=e.dataUrl,e})()}getImage(){return(0,m.Z)(function*(){return yield p.getPhoto({resultType:f.dk.DataUrl,source:f.oK.Photos})})()}}return(t=s).\u0275fac=function(e){return new(e||t)},t.\u0275prov=a.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),s})();var y=n(8433),Z=n(4875),M=n(7247),E=n(9796),C=n(7187);function I(t,s){if(1&t&&(a.TgZ(0,"div",5)(1,"a",6),a._UZ(2,"img",7),a.qZA()()),2&t){const c=a.oxw();a.xp6(1),a.Q6J("href",c.image.base64String,a.LSH),a.xp6(1),a.Q6J("src",c.image.base64String,a.LSH)}}const U=[{path:"",component:(()=>{var t;class s{constructor(e,r,l,g,b,S,P){this.cameraService=e,this.metadataService=r,this.signingService=l,this.filesystemService=g,this.snackbarService=b,this.globalVariablesService=S,this.router=P}ngOnInit(){var e=this;return(0,m.Z)(function*(){"denied"===(yield p.checkPermissions()).camera&&e.router.navigate(["missing-permission"])})()}checkImage(){var e=this;return(0,m.Z)(function*(){const r=yield e.cameraService.getImage();if(r.base64String=r.dataUrl,e.image=r,!r)return void e.snackbarService.openErrorSnackbar("Missing image to check");const l=e.metadataService.getMetadata(r);console.log("Loaded metadata",l);try{const g=e.metadataService.getPublicKey(r),b=e.metadataService.getSign(r),S=e.metadataService.clearSign(r);e.signingService.checkSign(S,b,g)?e.snackbarService.openSuccessSnackbar("The image is correctly signed"):e.snackbarService.openErrorSnackbar("The image has been forged")}catch(g){"string"==typeof g?e.snackbarService.openErrorSnackbar(g):g instanceof Error&&e.snackbarService.openErrorSnackbar(g.message)}})()}takePicture(){var e=this;return(0,m.Z)(function*(){const r=yield e.cameraService.takePicture();r||e.snackbarService.openErrorSnackbar("Failed to take picture"),e.image=r;try{const l=e.metadataService.getMetadata(r);e.globalVariablesService.setMetadata(l)}catch(l){"string"==typeof l?e.snackbarService.openErrorSnackbar(l):l instanceof Error&&e.snackbarService.openErrorSnackbar(l.message)}})()}savePicture(){var e=this;return(0,m.Z)(function*(){if(e.image)try{const r=e.metadataService.addMetadata(e.image);e.image.base64String=r;const l=yield e.filesystemService.saveImage(r,e.image.format);e.snackbarService.openSuccessSnackbar(`File saved at ${l.uri}`)}catch(r){"string"==typeof r?e.snackbarService.openErrorSnackbar(r):r instanceof Error&&e.snackbarService.openErrorSnackbar(r.message)}else e.snackbarService.openErrorSnackbar("No image to save")})()}}return(t=s).\u0275fac=function(e){return new(e||t)(a.Y36(h),a.Y36(y.D),a.Y36(Z.n),a.Y36(M.h),a.Y36(E.o),a.Y36(C.E),a.Y36(i.F0))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-tab2"]],decls:11,vars:3,consts:[[3,"translucent"],[3,"fullscreen"],[1,"row"],[1,"col-6","m-0","p-3",3,"click"],["class","m-3",4,"ngIf"],[1,"m-3"],["download","base64String",3,"href"],["id","image",3,"src"]],template:function(e,r){1&e&&(a.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),a._uU(3," Preview "),a.qZA()()(),a.TgZ(4,"ion-content",1)(5,"div",2)(6,"ion-button",3),a.NdJ("click",function(){return r.savePicture()}),a._uU(7,"Save image"),a.qZA(),a.TgZ(8,"ion-button",3),a.NdJ("click",function(){return r.takePicture()}),a._uU(9,"New picture"),a.qZA()(),a.YNc(10,I,3,2,"div",4),a.qZA()),2&e&&(a.Q6J("translucent",!0),a.xp6(4),a.Q6J("fullscreen",!0),a.xp6(6),a.Q6J("ngIf",r.image))},dependencies:[o.YG,o.W2,o.Gu,o.wd,o.sr,u.O5],styles:[".take-button[_ngcontent-%COMP%]{opacity:.2;position:fixed;bottom:15px;right:15px}"]}),s})()},{path:"missing-permission",component:(()=>{var t;class s{constructor(){}ngOnInit(){console.log("Error")}}return(t=s).\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-missing-permission"]],decls:11,vars:2,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"]],template:function(e,r){1&e&&(a.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),a._uU(3," Preview "),a.qZA()()(),a.TgZ(4,"ion-content",1)(5,"ion-header",2)(6,"ion-toolbar")(7,"ion-title",3),a._uU(8,"Tab 2"),a.qZA()()(),a.TgZ(9,"ion-item"),a._uU(10,"Missing permission"),a.qZA()()),2&e&&(a.Q6J("translucent",!0),a.xp6(4),a.Q6J("fullscreen",!0))},dependencies:[o.W2,o.Gu,o.Ie,o.wd,o.sr]}),s})()}];let A=(()=>{var t;class s{}return(t=s).\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[i.Bz.forChild(U),i.Bz]}),s})(),J=(()=>{var t;class s{}return(t=s).\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({providers:[h],imports:[o.Pc,u.ez,v.u5,A]}),s})()}}]);